
import { SignClient } from "@walletconnect/sign-client";

const projectId = "3d4f2125e123c4e678f222cbd4dc9edb"; // 临时 WalletConnect v2 projectId
const appDiv = document.getElementById("app");

async function connect() {
  const signClient = await SignClient.init({
    projectId,
    metadata: {
      name: "TrustWallet DApp Demo",
      description: "Connect Trust Wallet via WalletConnect v2",
      url: "https://your-dapp.com",
      icons: ["https://walletconnect.com/walletconnect-logo.png"],
    },
  });

  const { uri, approval } = await signClient.connect({
    requiredNamespaces: {
      eip155: {
        methods: ["eth_sendTransaction", "personal_sign", "eth_signTypedData"],
        chains: ["eip155:1"],
        events: ["chainChanged", "accountsChanged"],
      },
    },
  });

  if (uri) {
    const wcUri = encodeURIComponent(uri);
    const trustWalletUrl = `https://link.trustwallet.com/wc?uri=${wcUri}`;
    const qr = `<p><strong>Scan with Trust Wallet:</strong></p><a href="${trustWalletUrl}" target="_blank">${uri}</a>`;
    appDiv.innerHTML = qr;
  }

  const session = await approval();
  const address = session.namespaces.eip155.accounts[0].split(":")[2];
  appDiv.innerHTML += `<p>✅ Connected: ${address}</p>`;
}

connect();
